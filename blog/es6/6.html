<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ES6 系列（六）Promise 初探 | 余光的前端进阶笔记</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/summary/favicon.ico">
    <meta name="description" content="在这里一定有能帮助你成长的文章">
    
    <link rel="preload" href="/summary/assets/css/0.styles.9d25b92e.css" as="style"><link rel="preload" href="/summary/assets/js/app.896785e0.js" as="script"><link rel="preload" href="/summary/assets/js/2.db296de0.js" as="script"><link rel="preload" href="/summary/assets/js/76.92172994.js" as="script"><link rel="prefetch" href="/summary/assets/js/10.887bde13.js"><link rel="prefetch" href="/summary/assets/js/100.9b556869.js"><link rel="prefetch" href="/summary/assets/js/101.b398afc1.js"><link rel="prefetch" href="/summary/assets/js/102.e5231833.js"><link rel="prefetch" href="/summary/assets/js/103.503200da.js"><link rel="prefetch" href="/summary/assets/js/104.d0d45eff.js"><link rel="prefetch" href="/summary/assets/js/105.12d64733.js"><link rel="prefetch" href="/summary/assets/js/106.35c6fcd9.js"><link rel="prefetch" href="/summary/assets/js/107.7d6c8b33.js"><link rel="prefetch" href="/summary/assets/js/108.eb100cab.js"><link rel="prefetch" href="/summary/assets/js/109.0d9e5e23.js"><link rel="prefetch" href="/summary/assets/js/11.c873c282.js"><link rel="prefetch" href="/summary/assets/js/110.994d3003.js"><link rel="prefetch" href="/summary/assets/js/111.9f198662.js"><link rel="prefetch" href="/summary/assets/js/112.4bd34636.js"><link rel="prefetch" href="/summary/assets/js/113.5d438461.js"><link rel="prefetch" href="/summary/assets/js/114.16629ada.js"><link rel="prefetch" href="/summary/assets/js/115.eb7ea2b1.js"><link rel="prefetch" href="/summary/assets/js/116.4efa885f.js"><link rel="prefetch" href="/summary/assets/js/117.a81527f8.js"><link rel="prefetch" href="/summary/assets/js/118.c0112e29.js"><link rel="prefetch" href="/summary/assets/js/119.a508827b.js"><link rel="prefetch" href="/summary/assets/js/12.cda2ffc2.js"><link rel="prefetch" href="/summary/assets/js/120.5cfffe60.js"><link rel="prefetch" href="/summary/assets/js/121.fac0fcba.js"><link rel="prefetch" href="/summary/assets/js/122.edc2febe.js"><link rel="prefetch" href="/summary/assets/js/123.b129dc2a.js"><link rel="prefetch" href="/summary/assets/js/124.4dabe588.js"><link rel="prefetch" href="/summary/assets/js/125.735bd8f9.js"><link rel="prefetch" href="/summary/assets/js/126.175aa2d6.js"><link rel="prefetch" href="/summary/assets/js/127.8918fe3b.js"><link rel="prefetch" href="/summary/assets/js/128.2e58c990.js"><link rel="prefetch" href="/summary/assets/js/129.9b887848.js"><link rel="prefetch" href="/summary/assets/js/13.c492aba4.js"><link rel="prefetch" href="/summary/assets/js/130.0b4d2721.js"><link rel="prefetch" href="/summary/assets/js/131.e064d4b9.js"><link rel="prefetch" href="/summary/assets/js/132.3e79d496.js"><link rel="prefetch" href="/summary/assets/js/133.363108ec.js"><link rel="prefetch" href="/summary/assets/js/134.4eb8fe07.js"><link rel="prefetch" href="/summary/assets/js/135.e7d7425f.js"><link rel="prefetch" href="/summary/assets/js/136.d0f3bae4.js"><link rel="prefetch" href="/summary/assets/js/137.8f765c2c.js"><link rel="prefetch" href="/summary/assets/js/14.8f3c8c45.js"><link rel="prefetch" href="/summary/assets/js/15.8c6fd200.js"><link rel="prefetch" href="/summary/assets/js/16.82043f79.js"><link rel="prefetch" href="/summary/assets/js/17.b6bf0bb9.js"><link rel="prefetch" href="/summary/assets/js/18.05ff50be.js"><link rel="prefetch" href="/summary/assets/js/19.e1e4e180.js"><link rel="prefetch" href="/summary/assets/js/20.0f89db40.js"><link rel="prefetch" href="/summary/assets/js/21.d288e196.js"><link rel="prefetch" href="/summary/assets/js/22.e9e760f7.js"><link rel="prefetch" href="/summary/assets/js/23.c92a832a.js"><link rel="prefetch" href="/summary/assets/js/24.09c425f4.js"><link rel="prefetch" href="/summary/assets/js/25.e52ee497.js"><link rel="prefetch" href="/summary/assets/js/26.077be037.js"><link rel="prefetch" href="/summary/assets/js/27.2b65b971.js"><link rel="prefetch" href="/summary/assets/js/28.c820e554.js"><link rel="prefetch" href="/summary/assets/js/29.9e32e7ae.js"><link rel="prefetch" href="/summary/assets/js/3.38121976.js"><link rel="prefetch" href="/summary/assets/js/30.17e5f3d6.js"><link rel="prefetch" href="/summary/assets/js/31.53a2a911.js"><link rel="prefetch" href="/summary/assets/js/32.112540b7.js"><link rel="prefetch" href="/summary/assets/js/33.5c6afe00.js"><link rel="prefetch" href="/summary/assets/js/34.15ff3a9d.js"><link rel="prefetch" href="/summary/assets/js/35.3ee0122e.js"><link rel="prefetch" href="/summary/assets/js/36.95016b44.js"><link rel="prefetch" href="/summary/assets/js/37.d85c2746.js"><link rel="prefetch" href="/summary/assets/js/38.77d86bc4.js"><link rel="prefetch" href="/summary/assets/js/39.657aabdb.js"><link rel="prefetch" href="/summary/assets/js/4.0b789c4c.js"><link rel="prefetch" href="/summary/assets/js/40.c26da2fe.js"><link rel="prefetch" href="/summary/assets/js/41.663f2c85.js"><link rel="prefetch" href="/summary/assets/js/42.1ca39453.js"><link rel="prefetch" href="/summary/assets/js/43.e9b4f266.js"><link rel="prefetch" href="/summary/assets/js/44.428318b1.js"><link rel="prefetch" href="/summary/assets/js/45.ab7aa2c6.js"><link rel="prefetch" href="/summary/assets/js/46.99134f79.js"><link rel="prefetch" href="/summary/assets/js/47.019f6b3f.js"><link rel="prefetch" href="/summary/assets/js/48.27ae82eb.js"><link rel="prefetch" href="/summary/assets/js/49.e86d7397.js"><link rel="prefetch" href="/summary/assets/js/5.ce73fe59.js"><link rel="prefetch" href="/summary/assets/js/50.38b97655.js"><link rel="prefetch" href="/summary/assets/js/51.45d98e0c.js"><link rel="prefetch" href="/summary/assets/js/52.86c4e8d8.js"><link rel="prefetch" href="/summary/assets/js/53.ab707981.js"><link rel="prefetch" href="/summary/assets/js/54.87c1df61.js"><link rel="prefetch" href="/summary/assets/js/55.4189fd76.js"><link rel="prefetch" href="/summary/assets/js/56.71e6a163.js"><link rel="prefetch" href="/summary/assets/js/57.5b34ac35.js"><link rel="prefetch" href="/summary/assets/js/58.c2ddeccd.js"><link rel="prefetch" href="/summary/assets/js/59.15d60f51.js"><link rel="prefetch" href="/summary/assets/js/6.c8c90c3f.js"><link rel="prefetch" href="/summary/assets/js/60.170b55ea.js"><link rel="prefetch" href="/summary/assets/js/61.a5983160.js"><link rel="prefetch" href="/summary/assets/js/62.3d76ffeb.js"><link rel="prefetch" href="/summary/assets/js/63.3e87511e.js"><link rel="prefetch" href="/summary/assets/js/64.ef8c2820.js"><link rel="prefetch" href="/summary/assets/js/65.a3f4fcc8.js"><link rel="prefetch" href="/summary/assets/js/66.b237f383.js"><link rel="prefetch" href="/summary/assets/js/67.bad88afc.js"><link rel="prefetch" href="/summary/assets/js/68.6fab91b8.js"><link rel="prefetch" href="/summary/assets/js/69.05def84b.js"><link rel="prefetch" href="/summary/assets/js/7.ea69f02a.js"><link rel="prefetch" href="/summary/assets/js/70.90500405.js"><link rel="prefetch" href="/summary/assets/js/71.db1151a2.js"><link rel="prefetch" href="/summary/assets/js/72.a0ffdd1d.js"><link rel="prefetch" href="/summary/assets/js/73.0f610887.js"><link rel="prefetch" href="/summary/assets/js/74.c304413b.js"><link rel="prefetch" href="/summary/assets/js/75.52bfd461.js"><link rel="prefetch" href="/summary/assets/js/77.d1d8ed01.js"><link rel="prefetch" href="/summary/assets/js/78.a4a6b196.js"><link rel="prefetch" href="/summary/assets/js/79.647bfe13.js"><link rel="prefetch" href="/summary/assets/js/8.ceeaa406.js"><link rel="prefetch" href="/summary/assets/js/80.4593c243.js"><link rel="prefetch" href="/summary/assets/js/81.a0b24598.js"><link rel="prefetch" href="/summary/assets/js/82.5bbc7981.js"><link rel="prefetch" href="/summary/assets/js/83.c8b9b960.js"><link rel="prefetch" href="/summary/assets/js/84.52e3720a.js"><link rel="prefetch" href="/summary/assets/js/85.38319a0b.js"><link rel="prefetch" href="/summary/assets/js/86.af0a4e35.js"><link rel="prefetch" href="/summary/assets/js/87.fbfad258.js"><link rel="prefetch" href="/summary/assets/js/88.ed398122.js"><link rel="prefetch" href="/summary/assets/js/89.d12069e8.js"><link rel="prefetch" href="/summary/assets/js/9.211e8a94.js"><link rel="prefetch" href="/summary/assets/js/90.2657d350.js"><link rel="prefetch" href="/summary/assets/js/91.effea6ac.js"><link rel="prefetch" href="/summary/assets/js/92.483564d2.js"><link rel="prefetch" href="/summary/assets/js/93.91ea72ab.js"><link rel="prefetch" href="/summary/assets/js/94.c526e017.js"><link rel="prefetch" href="/summary/assets/js/95.b381e4c7.js"><link rel="prefetch" href="/summary/assets/js/96.5e031094.js"><link rel="prefetch" href="/summary/assets/js/97.d8c47dca.js"><link rel="prefetch" href="/summary/assets/js/98.c720edd2.js"><link rel="prefetch" href="/summary/assets/js/99.7707b8c7.js">
    <link rel="stylesheet" href="/summary/assets/css/0.styles.9d25b92e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/summary/" class="home-link router-link-active"><!----> <span class="site-name">余光的前端进阶笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/summary/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/summary/blog/" class="nav-link router-link-active">
  前端|博文
</a></div><div class="nav-item"><a href="/summary/algorithm/" class="nav-link">
  算法|题解
</a></div><div class="nav-item"><a href="/summary/css/" class="nav-link">
  CSS|博文
</a></div><div class="nav-item"><a href="https://github.com/webbj97/summary" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/summary/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/summary/blog/" class="nav-link router-link-active">
  前端|博文
</a></div><div class="nav-item"><a href="/summary/algorithm/" class="nav-link">
  算法|题解
</a></div><div class="nav-item"><a href="/summary/css/" class="nav-link">
  CSS|博文
</a></div><div class="nav-item"><a href="https://github.com/webbj97/summary" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript专题</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>ES6</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/summary/blog/es6/1.html" class="sidebar-link">ES6系列（一）let和const</a></li><li><a href="/summary/blog/es6/2.html" class="sidebar-link">ES6系列（二）变量的解构赋值</a></li><li><a href="/summary/blog/es6/3.html" class="sidebar-link">ES6系列（三）箭头函数</a></li><li><a href="/summary/blog/es6/4.html" class="sidebar-link">ES6系列（四）Iterator（遍历器）和for...of循环</a></li><li><a href="/summary/blog/es6/5.html" class="sidebar-link">ES6系列（五）set</a></li><li><a href="/summary/blog/es6/6.html" aria-current="page" class="active sidebar-link">ES6 系列（六）Promise 初探</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/summary/blog/es6/6.html#什么是-promise" class="sidebar-link">什么是 Promise</a></li><li class="sidebar-sub-header"><a href="/summary/blog/es6/6.html#一、基本用法" class="sidebar-link">一、基本用法</a></li><li class="sidebar-sub-header"><a href="/summary/blog/es6/6.html#二、then-和-catch" class="sidebar-link">二、then 和 catch</a></li><li class="sidebar-sub-header"><a href="/summary/blog/es6/6.html#三、promise-内部的错误" class="sidebar-link">三、Promise 内部的错误</a></li><li class="sidebar-sub-header"><a href="/summary/blog/es6/6.html#四、promise-prototype-finally" class="sidebar-link">四、Promise.prototype.finally()</a></li><li class="sidebar-sub-header"><a href="/summary/blog/es6/6.html#五、promise-all" class="sidebar-link">五、Promise.all()</a></li><li class="sidebar-sub-header"><a href="/summary/blog/es6/6.html#六、promise-race" class="sidebar-link">六、Promise.race()</a></li><li class="sidebar-sub-header"><a href="/summary/blog/es6/6.html#七、promise-allsettled" class="sidebar-link">七、Promise.allSettled()</a></li><li class="sidebar-sub-header"><a href="/summary/blog/es6/6.html#八、promise-any" class="sidebar-link">八、Promise.any()</a></li><li class="sidebar-sub-header"><a href="/summary/blog/es6/6.html#九、promise-resolve" class="sidebar-link">九、Promise.resolve()</a></li><li class="sidebar-sub-header"><a href="/summary/blog/es6/6.html#十、promise-reject" class="sidebar-link">十、Promise.reject()</a></li><li class="sidebar-sub-header"><a href="/summary/blog/es6/6.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/summary/blog/es6/10.html" class="sidebar-link">proxy</a></li><li><a href="/summary/blog/es6/11.html" class="sidebar-link">Reflect</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>网络</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>有意思的分享</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="es6-系列-六-promise-初探"><a href="#es6-系列-六-promise-初探" class="header-anchor">#</a> ES6 系列（六）Promise 初探</h1> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>这篇文章算是我对 Promise 其中基础部分的理解，因为阮一峰老师的 ES6 基础已经足够好了，本文更像是一个字典，我也会尽量串联起相关的知识点。
注意，本篇文章更像示例解释，下一篇我们一起研究点有意思的，共勉～</p></div> <h2 id="什么是-promise"><a href="#什么是-promise" class="header-anchor">#</a> 什么是 Promise</h2> <ul><li>是异步编程的一种解决方案</li> <li>是一个容器，里面保存着某个未来才会结束的事件的结果。</li> <li>是一个对象，从它可以获取异步操作的消息。</li></ul> <p><strong>Promise 对象有以下两个特点：</strong></p> <ol><li>对象的状态不受外界影响：
<ul><li>Promise 对象代表一个异步操作，有三种状态：pending（进行中）、fulfilled（已成功）和 rejected（已失败）</li> <li>只有异步操作的结果，可以决定当前是哪一种状态，任何其他操作都无法改变这个状态。</li></ul></li> <li>一旦状态改变，就不会再变：任何时候都可以得到这个结果。
<ul><li>Promise 对象的状态改变，只有两种可能：从<code>pending</code>变为<code>fulfilled</code>和从<code>pending</code>变为<code>rejected</code>。</li> <li>如果改变已经发生了，你再对 Promise 对象添加回调函数，也会立即得到这个结果。</li></ul></li></ol> <p><strong>优点</strong></p> <ol><li>Promise 对象，可以将异步操作以同步操作的流程表达出来，避免了层层嵌套的回调函数。</li> <li>此外，Promise 对象提供统一的接口，使得控制异步操作更加容易。</li></ol> <p><strong>缺点</strong></p> <ol><li>无法取消 Promise，一旦新建它就会立即执行，无法中途取消。</li> <li>如果不设置回调函数，Promise 内部抛出的错误，不会反应到外部。</li> <li>当处于 pending 状态时，无法得知目前进展到哪一个阶段（刚刚开始还是即将完成）。</li></ol> <p>读完上面这些，我对 promise 已经升起了“恐惧”，同步、异步、状态...茫茫多的“高级”词汇让人望而却步，别慌，不谈完全玩转它，先从认识他开始！加油</p> <h2 id="一、基本用法"><a href="#一、基本用法" class="header-anchor">#</a> 一、基本用法</h2> <ul><li><code>Promise构造函数</code>接受一个函数作为参数，该函数的两个参数分别是<code>resolve</code>和<code>reject</code>。它们是两个函数，由 JavaScript 引擎提供。</li></ul> <ol><li>resolve 函数的作用是，将 Promise 对象的状态从“未完成”变为“成功”（即从 pending 变为 resolved），在异步操作成功时调用，并将异步操作的结果，作为参数传递出去；</li> <li>reject 函数的作用是，将 Promise 对象的状态从“未完成”变为“失败”（即从 pending 变为 rejected），在异步操作失败时调用，并将异步操作报出的错误，作为参数传递出去。</li></ol> <p>Promise 实例生成以后，可以用 then 方法分别指定 resolved 状态和 rejected 状态的回调函数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 1</span>
<span class="token comment">// 3</span>
<span class="token comment">// 2</span>
</code></pre></div><p>上面代码中，打印数字的顺序和我们代码的位置有些出入，看到下面一节，大家就明白了～</p> <h2 id="二、then-和-catch"><a href="#二、then-和-catch" class="header-anchor">#</a> 二、then 和 catch</h2> <h4 id="_2-1-promise-prototype-then"><a href="#_2-1-promise-prototype-then" class="header-anchor">#</a> 2.1 Promise.prototype.then</h4> <p>then 方法的作用是为 Promise 实例添加状态改变时的回调函数。</p> <ul><li>第一个参数是 resolved（成功）状态的回调函数</li> <li>第二个参数是 rejected（失败）状态的回调函数。</li></ul> <p>then 方法返回的是一个新的 Promise 实例（注意，不是原来那个 Promise 实例）</p> <p><strong>示例</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> item <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> item <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> item <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//1</span>
<span class="token comment">//2</span>
<span class="token comment">//3</span>
</code></pre></div><h4 id="_2-2、promise-prototype-catch"><a href="#_2-2、promise-prototype-catch" class="header-anchor">#</a> 2.2、Promise.prototype.catch</h4> <p><code>catch</code> 方法，等于 <code>then</code> 方法的第二个参数的别名，用于指定发生错误时的回调函数。</p> <ul><li>如果该对象状态变为<code>resolved</code>，则会调用<code>then()</code>方法指定的回调函数;</li> <li>如果异步操作抛出错误，状态就会变为<code>rejected</code>，就会调用<code>catch()</code>方法指定的回调函数;</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;fulfilled:&quot;</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;rejected&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 等同于</span>
p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;fulfilled:&quot;</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;rejected:&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>注意，<code>then(</code>)方法指定的回调函数，如果运行中抛出错误，也会被<code>catch()</code>方法捕获;</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Error: test</span>
</code></pre></div><h2 id="三、promise-内部的错误"><a href="#三、promise-内部的错误" class="header-anchor">#</a> 三、Promise 内部的错误</h2> <h4 id="_3-1-promise-状态已经变成-resolved-再抛出错误是无效的。"><a href="#_3-1-promise-状态已经变成-resolved-再抛出错误是无效的。" class="header-anchor">#</a> 3.1 Promise 状态已经变成 resolved，再抛出错误是无效的。</h4> <p>因为 Promise 的状态一旦改变，就永久保持该状态，不会再变了。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;ok&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 状态改为完成</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 抛出错误、但不会被捕获到</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ok</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 并没有执行，因为没有状态 变为 成功后不会再改变了</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面代码中，Promise 在 resolve 语句后面，再抛出错误，不会被捕获，等于没有抛出。</p> <p>Promise 对象的错误具有<code>冒泡</code>性质，会一直向后传递，直到被捕获为止。也就是说，错误总是会被下一个 catch 语句捕获。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token string">&quot;/post/1.json&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">post</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">getJSON</span><span class="token punctuation">(</span>post<span class="token punctuation">.</span>commentURL<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">comments</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// some code</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 可以处理前面三个 Promise 产生的错误</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>一般来说，不要在 then()方法里面定义 Reject 状态的回调函数（即 then 的第二个参数），总是使用 catch 方法。</p> <h4 id="_3-3-promise-对象内部的错误不会影响代码运行"><a href="#_3-3-promise-对象内部的错误不会影响代码运行" class="header-anchor">#</a> 3.3 Promise 对象内部的错误不会影响代码运行</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">someAsyncThing</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 下面一行会报错，因为 x 没有声明</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">someAsyncThing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;everything is great&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Uncaught (in promise) ReferenceError: x is not defined</span>
<span class="token comment">// 123</span>
</code></pre></div><p>可以看到，promise 内部的错误不会影响外面的代码的运行，通俗的说法就是“Promise 会吃掉错误”。</p> <h4 id="_3-4-抛出的错误会传递到外层代码"><a href="#_3-4-抛出的错误会传递到外层代码" class="header-anchor">#</a> 3.4 抛出的错误会传递到外层代码</h4> <p>再看下面的例子。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 2</span>
<span class="token comment">// 1</span>
<span class="token comment">// Uncaught Error: 3</span>
</code></pre></div><p>上面代码中，Promise 指定在下一轮“事件循环”再抛出错误。到了那个时候，Promise 的运行已经结束了，所以这个错误是在 Promise 函数体外抛出的，会冒泡到最外层，成了未捕获的错误。</p> <h4 id="_3-4-catch-后面可以继续调用-then-方法。"><a href="#_3-4-catch-后面可以继续调用-then-方法。" class="header-anchor">#</a> 3.4 catch()后面可以继续调用 then()方法。</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">someAsyncThing</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 下面一行会报错，因为 x 没有声明</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">someAsyncThing</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;oh no&quot;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;carry on&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// oh no [ReferenceError: x is not defined]</span>
<span class="token comment">// carry on</span>
</code></pre></div><p>catch 捕获到 promise 中的报错后，仍然会执行紧接着之后的 then 方法。</p> <h2 id="四、promise-prototype-finally"><a href="#四、promise-prototype-finally" class="header-anchor">#</a> 四、Promise.prototype.finally()</h2> <p>finally()方法用于指定不管 Promise 对象最后状态如何，都会执行的操作。看名字就知道它是兜底的～</p> <h4 id="_4-1-finally-的特点"><a href="#_4-1-finally-的特点" class="header-anchor">#</a> 4.1 finally 的特点</h4> <ul><li>总会执行 finally 方法</li> <li>不接受参数，不依赖 Promise 的执行结果（即它的执行与状态无关）</li> <li>finally 方法总是会返回原来的值。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 在执行完then或catch的回调后，finally就可以就会执行</span>
promise
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>···<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>···<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>···<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">finally</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// this =&gt; promise实例</span>
  <span class="token keyword">let</span> <span class="token constant">P</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>constructor<span class="token punctuation">;</span> <span class="token comment">// Promsie对象</span>
  <span class="token keyword">const</span> <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Promise.resolve('123') =&gt; p.then(('123')=&gt;{ todo })</span>
    <span class="token constant">P</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">reject</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token constant">P</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> reason<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>不难看出来，finally 的方法就等于 then 和 catch 方法的集合，还可以看到，finally 方法总是会返回原来的值。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// resolve 的值是 undefined</span>
<span class="token comment">// 因为没有</span>
Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// resolve 的值是 2</span>
Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// reject 的值是 undefined</span>
Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// reject 的值是 3</span>
Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="五、promise-all"><a href="#五、promise-all" class="header-anchor">#</a> 五、Promise.all()</h2> <p>Promise.all()方法用于将多个 Promise 实例，包装成一个新的 Promise 实例。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面代码中，Promise.all()方法接受一个数组作为参数，p1、p2、p3 都是 Promise 实例，如果不是，就会先调用下面讲到的 Promise.resolve 方法，将参数转为 Promise 实例。</p> <p>p 的状态由数组内每个元素的状态决定，以上面的代码举例：</p> <ul><li>只有 p1、p2、p3 的状态都变成 <code>成功</code>，p 的状态才会变成 fulfilled，此时 p1、p2、p3 的返回值组成一个数组，传递给 p 的回调函数。</li> <li>反之，此时第一个被 reject 的实例的返回值，会传递给 p 的回调函数。</li></ul> <p>注意，如果作为参数的 Promise 实例，自己定义了 catch 方法，那么它一旦被 rejected，并不会触发 Promise.all()的 catch 方法。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> result<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;报错了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> result<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>

Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// [&quot;hello&quot;, Error: 报错了]</span>
</code></pre></div><p>分析代码：</p> <ol><li>p1 实例正常 resolve</li> <li>p2 首先会 rejected，
<ul><li>p2 有自己的 catch 方法，捕获错误并返回了一个新的 Promise 实例，p2 指向的实际上是这个实例。</li> <li>新实例执行完 catch 方法后，也会变成 resolve</li></ul></li> <li>Promise.all()方法参数里面的两个实例都会 resolved，因此会调用 then 方法指定的回调函数，而不会调用 catch 方法指定的回调函数。</li></ol> <h2 id="六、promise-race"><a href="#六、promise-race" class="header-anchor">#</a> 六、Promise.race()</h2> <p>race，角逐、比赛，顾名思义，它和 all 一样接受多个 Promise 实例、只要有一个实例改变状态，它就会跟着改变</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面代码中，只要 p1、p2、p3 之中有一个实例率先改变状态，p 的状态就跟着改变。那个<strong>率先</strong>改变的 Promise 实例的返回值，就传递给 p 的回调函数。</p> <p><code>Promise.race()</code>方法的参数与 <code>Promise.all()</code>方法一样，如果不是 Promise 实例，就会先调用下面讲到的 <code>Promise.resolve()</code>方法，将参数转为 Promise 实例，再进一步处理。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;/resource-that-may-take-a-while&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;request timeout&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 5s内请求没有得到返回，第二个实例就会抛出错误了～</span>
p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>分析代码：</p> <ol><li></li></ol> <p>上面代码中，如果 5 秒之内 fetch 方法无法返回结果，变量 p 的状态就会变为 rejected，从而触发 catch 方法指定的回调函数。</p> <h2 id="七、promise-allsettled"><a href="#七、promise-allsettled" class="header-anchor">#</a> 七、Promise.allSettled()</h2> <p>Promise.allSettled()方法接受一组 Promise 实例作为参数，包装成一个新的 Promise 实例。只有等到所有这些参数实例都返回结果，不管是 fulfilled 还是 rejected，包装实例才会结束。</p> <p>该方法返回的新的 Promise 实例，一旦结束，状态总是 <code>fulfilled</code>，不会变成 <code>rejected</code>。Promise 的监听函数接收到的参数是一个数组，每个成员对应一个传入 Promise.allSettled()的 Promise 实例。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> resolved <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> rejected <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> allSettledPromise <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">allSettled</span><span class="token punctuation">(</span><span class="token punctuation">[</span>resolved<span class="token punctuation">,</span> rejected<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

allSettledPromise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">results</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// [</span>
<span class="token comment">// { status: 'fulfilled', value: 42 },</span>
<span class="token comment">// { status: 'rejected', reason: -1 }</span>
<span class="token comment">// ]</span>
</code></pre></div><p>上面代码中，Promise.allSettled()的返回值 allSettledPromise，状态只可能变成 fulfilled。</p> <p>它的监听函数接收到的参数是数组 results。该数组的每个成员都是一个对象，对应传入 Promise.allSettled()的两个 Promise 实例。</p> <ul><li>每个对象都有 <code>status</code> 属性：（<code>'fulfilled'</code> 或 <code>'rejected'</code>）
<ul><li>fulfilled 时，对象有 <code>value</code> 属性</li> <li>rejected 时有 <code>reason</code> 属性，对应两种状态的返回值。</li></ul></li></ul> <p>下面是返回值用法的例子。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> promises <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;index.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;https://does-not-exist/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> results <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">allSettled</span><span class="token punctuation">(</span>promises<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 过滤出成功的请求</span>
<span class="token keyword">const</span> successfulPromises <span class="token operator">=</span> results<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 过滤出失败的请求，并输出原因</span>
<span class="token keyword">const</span> errors <span class="token operator">=</span> results
  <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>有时候，我们不关心异步操作的结果，只关心这些操作有没有结束。这时，Promise.allSettled()方法就很有用。</p> <h2 id="八、promise-any"><a href="#八、promise-any" class="header-anchor">#</a> 八、Promise.any()</h2> <p>该方法接受一组 Promise 实例作为参数，包装成一个新的 Promise 实例返回。只要参数实例有一个变成 fulfilled 状态，包装实例就会变成 fulfilled 状态；如果所有参数实例都变成 rejected 状态，包装实例就会变成 rejected 状态。</p> <p>从判定条件上它和数组的的方法 some 很相似</p> <p>Promise.any()跟 Promise.race()方法很像，只有一点不同，就是不会因为某个 Promise 变成 rejected 状态而结束。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> promises <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;/endpoint-a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;/endpoint-b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;/endpoint-c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">&quot;c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> first <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span>promises<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>first<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面代码中，Promise.any()方法的参数数组包含三个 Promise 操作。其中只要有一个变成 fulfilled，Promise.any()返回的 Promise 对象就变成 fulfilled。如果所有三个操作都变成 rejected，那么 await 命令就会抛出错误。</p> <h2 id="九、promise-resolve"><a href="#九、promise-resolve" class="header-anchor">#</a> 九、Promise.resolve()</h2> <p>有时需要将现有对象转为 Promise 对象，Promise.resolve()方法就起到这个作用。</p> <p>Promise.resolve()等价于下面的写法。</p> <div class="language-js extra-class"><pre class="language-js"><code>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 等价于</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>分析代码：</strong></p> <ol><li>生成一个 Promise 对象的实例 p</li> <li>状态改变为 resolved</li> <li>立即执行 thenable 对象的 then()方法</li></ol> <h4 id="_9-1-promise-resolve-的参数"><a href="#_9-1-promise-resolve-的参数" class="header-anchor">#</a> 9.1 Promise.resolve()的参数</h4> <ol><li>如果参数是 Promise 实例，那么 Promise.resolve 将不做任何修改、原封不动地返回这个实例。</li> <li>thenable 对象指的是具有 then 方法的对象，比如下面这个对象。</li> <li>如果参数是一个原始值，或者是一个不具有 then()方法的对象，则 Promise.resolve()方法返回一个新的 Promise 对象，状态为 resolved。</li> <li>没有任何参数，直接返回一个 resolved 状态的 Promise 对象。</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 第二点</span>
<span class="token keyword">let</span> thenable <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">then</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> p1 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>thenable<span class="token punctuation">)</span><span class="token punctuation">;</span>
p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 42</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 上面代码中，thenable 对象的 then()方法执行后，对象 p1 的状态就变为 resolved，从而立即执行最后那个 then()方法指定的回调函数，输出 42。</span>

<span class="token comment">// 第三点</span>
<span class="token keyword">const</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Hello</span>
<span class="token comment">// 上面代码生成一个新的 Promise 对象的实例 p。</span>
<span class="token comment">// 由于字符串 Hello 不属于异步操作（判断方法是字符串对象不具有 then 方法），返回 Promise 实例的状态从一生成就是 resolved，所以回调函数会立即执行。</span>
<span class="token comment">// Promise.resolve()方法的参数，会同时传给回调函数。</span>
</code></pre></div><h2 id="十、promise-reject"><a href="#十、promise-reject" class="header-anchor">#</a> 十、Promise.reject()</h2> <p>Promise.reject(reason)方法也会返回一个新的 Promise 实例，该实例的状态为 rejected。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&quot;出错了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 等同于</span>
<span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&quot;出错了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

p<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>分析代码：</strong></p> <ol><li>生成一个 Promise 对象的实例 p</li> <li>状态改变为 rejected</li> <li>立即执行回调函数</li></ol> <p>Promise.reject()方法的参数，会原封不动地作为 reject 的理由，变成后续方法的参数。</p> <div class="language-js extra-class"><pre class="language-js"><code>Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&quot;出错了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e <span class="token operator">===</span> <span class="token string">&quot;出错了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// true</span>
</code></pre></div><p>上面代码中，Promise.reject()方法的参数是一个字符串，后面 catch()方法的参数 e 就是这个字符串。</p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <ul><li><p>reject</p> <ul><li><code>reject</code>方法的作用，等同于抛出错误</li> <li>总是用<code>catch</code>方法来代替<code>then</code>方法里的<code>reject</code>回调函数</li></ul></li> <li><p>finally</p> <ul><li>不管 promise 最后的状态，在执行完 then 或 catch 指定的回调函数以后，都会执行 finally 方法指定的回调函数。</li> <li><code>finally</code>可以看做是<code>then</code>和<code>catch</code>的集合</li></ul></li> <li><p>all</p> <ul><li>Promise.all 会返回新的 promise 实例</li></ul> <p><strong>小结</strong></p></li></ul> <ol><li>Promise 实例状态改变时会执行 then 方法内的回调函数；</li> <li>then 方法允许接受两个状态(成功、失败)改变的回调函数，并且返回的是新的 Promise 实例；</li> <li>catch 是 then 的一部分，且我们推荐使用 catch 这种直观的方式；</li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/summary/blog/es6/5.html" class="prev">
        ES6系列（五）set
      </a></span> <span class="next"><a href="/summary/blog/es6/10.html">
        proxy
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/summary/assets/js/app.896785e0.js" defer></script><script src="/summary/assets/js/2.db296de0.js" defer></script><script src="/summary/assets/js/76.92172994.js" defer></script>
  </body>
</html>
